<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jindam.app.notification.mapper.ChatMapper">
    <insert id="selectChatRoomByUserId" parameterType="ChatInsertRequestDto">
        SELECT
            chatroom_member_id
            chatroom_id
            uid
            chatroom_name
        FROM
            (SELECT
                 *
             FROM tb_chatroom_member
             WHERE uid = #{writeUid} AND delete_yn = 'N' AND delete_at IS null AND delete_id IS NULL) me
                JOIN (SELECT * FROM tb_chatroom_member
                      WHERE uid = #{receiverId} AND delete_yn = 'N' AND delete_at IS null AND delete_id IS NULL) trg
                ON me.chatroom_id = trg.chatroom_id
    </insert>

    <insert id="insertChatRoom" parameterType="ChatInsertRequestDto">
        INSERT INTO tb_chatroom (
            chatroom_id
            create_at
            create_id
        ) VALUES (
             nextval('seq_tb_chatroom'),
             now(),
             #{writeUid}
           )

    </insert>

</mapper>